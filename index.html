<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Generator Orar Avansat â€“ A4 Landscape (Clasele Iâ€“IV)</title>
  <!-- CSS extern pentru designuri superbe -->
  <link rel="stylesheet" href="styles.css?v=2.1">
  <!-- Cache busting pentru utilizatori -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <!-- html2canvas for PNG export -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body data-theme="playful">
  <div class="app">
    <!-- Panel de Control Orizontal -->
    <div class="control-panel">
      <div class="panel-header">
        <h1 class="panel-title">ğŸ¨ Generator Orar Avansat</h1>
        <div class="panel-subtitle">Pentru clasele Iâ€“IV â€¢ 12 designuri superbe â€¢ Format A4 landscape perfect pentru printare â€¢ Cu suport complet pentru diacritice romÃ¢neÈ™ti</div>
      </div>

      <!-- InformaÈ›ii de BazÄƒ - Grid Orizontal -->
      <div class="form-grid">
        <div class="form-group">
          <label for="school">ğŸ« Liceu/È˜coalÄƒ</label>
          <input id="school" type="text" value="Liceul Energetic, Craiova" placeholder="Ex: Liceul Energetic, Craiova"/>
        </div>
        <div class="form-group">
          <label for="year">ğŸ“… An È™colar</label>
          <input id="year" type="text" value="2025â€“2026" placeholder="Ex: 2025-2026"/>
        </div>
        <div class="form-group">
          <label for="grade">ğŸ“ Clasa</label>
          <input id="grade" type="text" value="Clasa a III-a" placeholder="Ex: Clasa a III-a"/>
        </div>
        <div class="form-group">
          <label for="theme">ğŸ¨ Design (16 teme)</label>
          <select id="theme">
            <option value="playful">ğŸŒˆ JucÄƒuÈ™ Pastel (recomandat Iâ€“IV)</option>
            <option value="rainbow">ğŸŒˆ Curcubeu Magic</option>
            <option value="butterfly">ğŸ¦‹ Fluturi È™i Flori</option>
            <option value="jungle">ğŸŒ¿ AventurÄƒ Ã®n JunglÄƒ</option>
            <option value="ocean">ğŸŒŠ Ocean Albastru</option>
            <option value="space">ğŸš€ SpaÈ›iul Cosmic</option>
            <option value="candy">ğŸ­ Dulciuri È™i Bomboane</option>
            <option value="animals">ğŸ» AnimÄƒluÈ›e DrÄƒguÈ›e</option>
            <option value="chalk">ğŸ“š TablÄƒ de Scris</option>
            <option value="princess">ğŸ‘¸ PrinÈ›ese È™i Casteluri</option>
            <option value="robots">ğŸ¤– RoboÈ›i È™i Tehnologie</option>
            <option value="fairytale">âœ¨ PoveÈ™ti de Basm</option>
            <option value="paper">ğŸ“œ Pergament Antic</option>
            <option value="neon">âš¡ Neon Electric</option>
            <option value="wood">ğŸŒ³ Lemn Natural</option>
            <option value="marble">ğŸ’ MarmurÄƒ ElegantÄƒ</option>
          </select>
        </div>
        <div class="form-group">
          <label for="director">ğŸ‘” Director</label>
          <input id="director" type="text" value="Prof. Gabriela Achim" placeholder="Ex: Prof. Gabriela Achim"/>
        </div>
        <div class="form-group">
          <label for="teacher">ğŸ‘©â€ğŸ« Prof. Ã®nv. primar</label>
          <input id="teacher" type="text" value="CÃ¢rstea Ionica" placeholder="Ex: CÃ¢rstea Ionica"/>
        </div>
        <div class="form-group">
          <label for="timeFormat">ğŸ• Format Ore</label>
          <select id="timeFormat">
            <option value="hours">08:00-08:50, 09:00-09:50...</option>
            <option value="numbers">1, 2, 3, 4, 5...</option>
          </select>
        </div>
      </div>

      <!-- Import din Excel/Word cu Detectare AutomatÄƒ - Collapsible -->
      <div class="import-section collapsed" id="importSection">
        <div class="import-header" onclick="toggleImportSection()">
          <span>ğŸ“‹ Import Automat din Excel/Word</span>
          <span class="import-toggle">ğŸ”½</span>
        </div>
        <div class="import-content">
          <p style="color: var(--muted); margin-bottom: 12px; text-align: center;">
            CopiazÄƒ orarul din Excel sau Word È™i lipeÈ™te aici. Detectarea este automatÄƒ!
          </p>
          
          
          <div class="import-options">
            <div>
              <label>ğŸ“Š Format Excel/Tabel</label>
              <textarea id="excel-paste" class="import-textarea" placeholder="Luni	MarÈ›i	Miercuri	Joi	Vineri&#10;MatematicÄƒ	RomÃ¢nÄƒ	È˜tiinÈ›e	Sport	Arte&#10;RomÃ¢nÄƒ	MatematicÄƒ	Arte	È˜tiinÈ›e	MuzicÄƒ"></textarea>
              <button class="btn secondary" onclick="importFromExcel()">ğŸ“¥ ImportÄƒ din Excel</button>
            </div>
            <div>
              <label>ğŸ“ Format Word/Text</label>
              <textarea id="word-paste" class="import-textarea" placeholder="Luni:&#10;MatematicÄƒ&#10;RomÃ¢nÄƒ&#10;Sport&#10;&#10;MarÈ›i:&#10;È˜tiinÈ›e&#10;Arte&#10;MuzicÄƒ"></textarea>
              <button class="btn secondary" onclick="importFromWord()">ğŸ“„ ImportÄƒ din Word</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Editor de Zile cu Imagini/Emoji -->
      <div class="days-editor" id="daysEditor">
        <!-- Se va genera dinamic -->
      </div>

      <!-- Template-uri Salvate -->
      <div class="templates-section" id="templatesSection">
        <h3 style="font-size: 14px; color: var(--accent); margin: 15px 0 10px 0;">ğŸ“ Template-uri Salvate</h3>
        <div class="templates-list" id="templatesList">
          <!-- Se va genera dinamic -->
        </div>
      </div>

      <!-- Butoane de Control -->
      <div class="controls">
        <button class="btn" onclick="generateSchedule()">ğŸ¯ GenereazÄƒ Orarul</button>
        <button class="btn secondary" onclick="window.print()">ğŸ–¨ï¸ Print / PDF</button>
        <button class="btn secondary" onclick="exportToPNG()">ğŸ“¸ DescarcÄƒ PNG</button>
        <button class="btn outline" onclick="saveTemplate()">ğŸ’¾ SalveazÄƒ Template</button>
        <button class="btn outline" onclick="clearAll()">ğŸ§¹ GoleÈ™te Tot</button>
      </div>

      <div id="successMessage"></div>
    </div>

    <!-- Popup Custom pentru Confirmare -->
    <div id="confirmModal" class="modal-overlay" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">Confirmare</h3>
          <button class="modal-close" onclick="closeConfirmModal()">âœ•</button>
        </div>
        <div class="modal-body">
          <p id="modalMessage">Sigur vrei sÄƒ continui?</p>
        </div>
        <div class="modal-footer">
          <button class="btn outline" onclick="closeConfirmModal()">AnuleazÄƒ</button>
          <button class="btn" id="confirmButton" onclick="confirmAction()">ConfirmÄƒ</button>
        </div>
      </div>
    </div>

    <!-- Previzualizare CentratÄƒ -->
    <div class="preview-section">
      <section id="sheet" class="sheet" aria-label="Previzualizare orar A4">
        <div class="ribbons">
          <span class="ribbon r1"></span>
          <span class="ribbon r2"></span>
          <span class="ribbon r3"></span>
        </div>
        
        <div class="sheet-inner">
          <!-- Header conform .docx: È™coala stÃ¢nga sus, directorul dreapta sus -->
          <div class="header">
            <div class="school-info" id="outSchool">LICEUL ENERGETIC, CRAIOVA</div>
            <div class="director-info" id="outDirector">Director: Prof. Gabriela Achim</div>
          </div>

          <!-- Titlu centrat cu anul È™colar -->
          <div class="title-section">
            <div class="main-title" id="outTitle">ORAR â€“ CLASA A III-A</div>
            <div class="year-subtitle" id="outYear">Anul È™colar 2025â€“2026</div>
          </div>

          <!-- Tabelul cu orarul -->
          <div class="schedule-grid" id="grid">
            <!-- Se va genera dinamic -->
          </div>

          <!-- SemnÄƒturi conform .docx: profesorul Ã®n dreapta jos -->
          <div class="signatures">
            <div class="signature">
              <div class="sig-role">Prof. Ã®nv. primar</div>
              <div class="sig-name" id="outTeacher">CÃ¢rstea Ionica</div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // Date È™i configurare
    const dayNames = ["Luni", "MarÈ›i", "Miercuri", "Joi", "Vineri"];
    // Lista completÄƒ de emoji pentru materii cu auto-detectare inteligentÄƒ
    const subjectEmojiList = [
      // MatematicÄƒ È™i È™tiinÈ›e exacte
      { keywords: ['matematicÄƒ', 'mate'], emoji: 'ğŸ”¢', category: 'MatematicÄƒ' },
      { keywords: ['matematicÄƒ È™i È™tiinÈ›e Ã®n societatea cunoaÈ™terii', 'mate È™i È™tiinÈ›e'], emoji: 'ğŸ§ ', category: 'MatematicÄƒ' },
      { keywords: ['geometrie'], emoji: 'ğŸ“', category: 'MatematicÄƒ' },
      { keywords: ['algebrÄƒ'], emoji: 'ğŸ§®', category: 'MatematicÄƒ' },
      
      // Limba romÃ¢nÄƒ È™i limbi strÄƒine - Doar cele 3 principale
      { keywords: ['romÃ¢nÄƒ', 'limba romÃ¢nÄƒ', 'limba È™i literatura romÃ¢nÄƒ', 'llr'], emoji: 'ğŸ“š', category: 'Limbi' },
      { keywords: ['englezÄƒ', 'limba englezÄƒ', 'english'], emoji: 'ğŸ‡¬ğŸ‡§', category: 'Limbi' },
      { keywords: ['francezÄƒ', 'limba francezÄƒ', 'franÃ§ais'], emoji: 'ğŸ‡«ğŸ‡·', category: 'Limbi' },
      
      // È˜tiinÈ›e naturale
      { keywords: ['È™tiinÈ›e', 'È™tiinÈ›e ale naturii', 'È™tiinÈ›e naturale'], emoji: 'ğŸ”¬', category: 'È˜tiinÈ›e' },
      { keywords: ['fizicÄƒ'], emoji: 'âš¡', category: 'È˜tiinÈ›e' },
      { keywords: ['chimie'], emoji: 'ğŸ§ª', category: 'È˜tiinÈ›e' },
      { keywords: ['biologie'], emoji: 'ğŸŒ±', category: 'È˜tiinÈ›e' },
      { keywords: ['geografie'], emoji: 'ğŸŒ', category: 'È˜tiinÈ›e' },
      
      // Sport È™i miÈ™care
      { keywords: ['sport', 'educaÈ›ie fizicÄƒ', 'ed fizicÄƒ'], emoji: 'â›¹ï¸', category: 'Sport' },
      { keywords: ['joc È™i miÈ™care', 'jocuri', 'miÈ™care'], emoji: 'ğŸƒâ€â™‚ï¸', category: 'Sport' },
      { keywords: ['gimnasticÄƒ'], emoji: 'ğŸ¤¸â€â™€ï¸', category: 'Sport' },
      { keywords: ['dans'], emoji: 'ğŸ’ƒ', category: 'Sport' },
      
      // Arte È™i creativitate
      { keywords: ['arte', 'arte vizuale', 'arte vizuale È™i abilitÄƒÈ›i practice'], emoji: 'ğŸ¨', category: 'Arte' },
      { keywords: ['muzicÄƒ', 'educaÈ›ie muzicalÄƒ'], emoji: 'ğŸµ', category: 'Arte' },
      { keywords: ['muzicÄƒ È™i miÈ™care'], emoji: 'ğŸµğŸƒâ€â™‚ï¸', category: 'Arte' },
      { keywords: ['desen'], emoji: 'âœï¸', category: 'Arte' },
      { keywords: ['picturÄƒ'], emoji: 'ğŸ–Œï¸', category: 'Arte' },
      { keywords: ['teatru'], emoji: 'ğŸ­', category: 'Arte' },
      
      // È˜tiinÈ›e sociale È™i umane
      { keywords: ['istorie'], emoji: 'ğŸ›ï¸', category: 'Umane' },
      { keywords: ['educaÈ›ie civicÄƒ', 'civicÄƒ'], emoji: 'ğŸ›ï¸', category: 'Umane' },
      { keywords: ['religie', 'educaÈ›ie religioasÄƒ'], emoji: 'â›ª', category: 'Umane' },
      { keywords: ['filozofie'], emoji: 'ğŸ¤”', category: 'Umane' },
      
      // Tehnologie È™i practicÄƒ
      { keywords: ['informaticÄƒ', 'tic'], emoji: 'ğŸ’»', category: 'Tehnologie' },
      { keywords: ['educaÈ›ie tehnologicÄƒ', 'tehnologie'], emoji: 'ğŸ”§', category: 'Tehnologie' },
      { keywords: ['roboticÄƒ'], emoji: 'ğŸ¤–', category: 'Tehnologie' },
      
      // ActivitÄƒÈ›i speciale
      { keywords: ['consiliere', 'consiliere È™i orientare'], emoji: 'ğŸ’­', category: 'Consiliere' },
      { keywords: ['diriginÈ›ie', 'dirigentie', 'ora dirigintelui'], emoji: 'ğŸ‘¨â€ğŸ«', category: 'Consiliere' },
      { keywords: ['activitÄƒÈ›i remediale', 'remediale'], emoji: 'ğŸ“–', category: 'Remediale' },
      { keywords: ['activitÄƒÈ›i remediale llr', 'remediale romÃ¢nÄƒ'], emoji: 'ğŸ“', category: 'Remediale' },
      { keywords: ['activitÄƒÈ›i remediale matematicÄƒ', 'remediale matematicÄƒ'], emoji: 'ğŸ§®', category: 'Remediale' },
      
      // Materii opÈ›ionale
      { keywords: ['psihologie'], emoji: 'ğŸ§ ', category: 'OpÈ›ionale' },
      { keywords: ['ecologie'], emoji: 'ğŸŒ¿', category: 'OpÈ›ionale' },
      { keywords: ['astronomie'], emoji: 'ğŸŒŸ', category: 'OpÈ›ionale' },
      { keywords: ['educaÈ›ie economicÄƒ'], emoji: 'ğŸ’°', category: 'OpÈ›ionale' },
      { keywords: ['educaÈ›ie pentru sÄƒnÄƒtate'], emoji: 'ğŸ¥', category: 'OpÈ›ionale' }
    ];

    // FuncÈ›ie Ã®mbunÄƒtÄƒÈ›itÄƒ pentru auto-detectarea emoji-ului
    const subjectIcons = {};
    subjectEmojiList.forEach(item => {
      item.keywords.forEach(keyword => {
        subjectIcons[keyword] = item.emoji;
      });
    });

    // Orar predefinit pentru clasa a III-a (din documentul .docx)
    const predefinedSchedule = {
      "Luni": [
        "Limba È™i literatura romÃ¢nÄƒ",
        "Limba englezÄƒ", 
        "Limba È™i literatura romÃ¢nÄƒ",
        "EducaÈ›ie civicÄƒ",
        "ActivitÄƒÈ›i remediale LLR"
      ],
      "MarÈ›i": [
        "MatematicÄƒ",
        "MatematicÄƒ",
        "È˜tiinÈ›e ale naturii", 
        "Limba È™i literatura romÃ¢nÄƒ",
        "Arte vizuale È™i abilitÄƒÈ›i practice"
      ],
      "Miercuri": [
        "EducaÈ›ie fizicÄƒ",
        "MatematicÄƒ",
        "MatematicÄƒ",
        "Religie",
        "Limba englezÄƒ"
      ],
      "Joi": [
        "Limba È™i literatura romÃ¢nÄƒ",
        "Limba È™i literatura romÃ¢nÄƒ", 
        "Joc È™i miÈ™care",
        "MatematicÄƒ È™i È™tiinÈ›e Ã®n societatea cunoaÈ™terii",
        "ActivitÄƒÈ›i remediale matematicÄƒ"
      ],
      "Vineri": [
        "EducaÈ›ie fizicÄƒ",
        "Limba englezÄƒ",
        "MuzicÄƒ È™i miÈ™care", 
        "Arte vizuale È™i abilitÄƒÈ›i practice"
      ]
    };

    // Lista tuturor materiilor pentru referinÈ›Äƒ
    const allSubjects = [
      "Limba È™i literatura romÃ¢nÄƒ",
      "MatematicÄƒ", 
      "È˜tiinÈ›e ale naturii",
      "EducaÈ›ie fizicÄƒ",
      "Arte vizuale È™i abilitÄƒÈ›i practice",
      "Limba englezÄƒ",
      "EducaÈ›ie civicÄƒ",
      "Religie",
      "Joc È™i miÈ™care",
      "MatematicÄƒ È™i È™tiinÈ›e Ã®n societatea cunoaÈ™terii",
      "MuzicÄƒ È™i miÈ™care",
      "ActivitÄƒÈ›i remediale LLR",
      "ActivitÄƒÈ›i remediale matematicÄƒ"
    ];

    // Starea aplicaÈ›iei - va fi iniÈ›ializatÄƒ cu orarul predefinit
    let state = {
      days: dayNames.map(name => ({
        name,
        count: 0,
        subjects: []
      }))
    };

    // ConstruieÈ™te editorul de zile
    function buildDaysEditor() {
      const editor = document.getElementById('daysEditor');
      editor.innerHTML = '';

      state.days.forEach((day, dayIndex) => {
        const dayCard = document.createElement('div');
        dayCard.className = 'day-card slide-in';
        
        dayCard.innerHTML = `
          <div class="day-title">
            <span>${day.name}</span>
            <div class="hour-controls">
              <label for="count-${dayIndex}">Nr. ore</label>
              <input id="count-${dayIndex}" type="number" min="0" max="10" step="1" 
                     value="${day.count}" class="hour-input" 
                     onchange="updateDayHours(${dayIndex}, this.value)" />
            </div>
          </div>
          <div class="subjects-list" id="subjects-${dayIndex}"></div>
        `;
        
        editor.appendChild(dayCard);
        renderSubjectInputs(dayIndex);
      });
    }

    // RedÄƒ inputurile pentru materii
    function renderSubjectInputs(dayIndex) {
      const container = document.getElementById(`subjects-${dayIndex}`);
      const day = state.days[dayIndex];
      container.innerHTML = '';

      for (let i = 0; i < day.count; i++) {
        const subject = day.subjects[i] || { text: "", icon: "", image: "" };
        
        const inputGroup = document.createElement('div');
        inputGroup.className = 'subject-input-group';
        
        inputGroup.innerHTML = `
          <input type="text" class="subject-input" 
                 value="${subject.text}" 
                 placeholder="Ora ${i + 1} - Ex: MatematicÄƒ, Limba romÃ¢nÄƒ"
                 onchange="updateSubjectText(${dayIndex}, ${i}, this.value)" />
          <div class="emoji-selector-container">
            <select class="emoji-select" onchange="updateSubjectIcon(${dayIndex}, ${i}, this.value)">
              <option value="">ğŸ“– Alege emoji</option>
              ${getEmojiOptions(subject.icon)}
            </select>
          </div>
          <input type="text" class="image-input" 
                 value="${subject.image}" 
                 placeholder="URL imagine"
                 title="URL cÄƒtre imagine (opÈ›ional)"
                 onchange="updateSubjectImage(${dayIndex}, ${i}, this.value)" />
        `;
        
        container.appendChild(inputGroup);
      }
    }

    // ActualizeazÄƒ numÄƒrul de ore pentru o zi
    function updateDayHours(dayIndex, hours) {
      const numHours = Math.max(0, Math.min(10, parseInt(hours) || 0));
      const day = state.days[dayIndex];
      day.count = numHours;
      
      // AjusteazÄƒ array-ul de materii
      while (day.subjects.length < numHours) {
        day.subjects.push({ text: "", icon: "", image: "" });
      }
      if (day.subjects.length > numHours) {
        day.subjects = day.subjects.slice(0, numHours);
      }
      
      renderSubjectInputs(dayIndex);
      
      // Auto-salvare
      autoSaveData();
    }

    // ActualizeazÄƒ textul unei materii
    function updateSubjectText(dayIndex, subjectIndex, text) {
      if (!state.days[dayIndex].subjects[subjectIndex]) {
        state.days[dayIndex].subjects[subjectIndex] = { text: "", icon: "", image: "" };
      }
      state.days[dayIndex].subjects[subjectIndex].text = text;
      
      // Auto-detectare icon pe baza textului
      const newIcon = getSubjectIcon(text);
      if (newIcon && newIcon !== 'ğŸ“–') {
        state.days[dayIndex].subjects[subjectIndex].icon = newIcon;
        renderSubjectInputs(dayIndex);
      }
      
      // Auto-salvare
      autoSaveData();
    }

    // ActualizeazÄƒ iconul unei materii
    function updateSubjectIcon(dayIndex, subjectIndex, icon) {
      if (!state.days[dayIndex].subjects[subjectIndex]) {
        state.days[dayIndex].subjects[subjectIndex] = { text: "", icon: "", image: "" };
      }
      state.days[dayIndex].subjects[subjectIndex].icon = icon;
      
      // Auto-salvare
      autoSaveData();
    }

    // ActualizeazÄƒ imaginea unei materii
    function updateSubjectImage(dayIndex, subjectIndex, image) {
      if (!state.days[dayIndex].subjects[subjectIndex]) {
        state.days[dayIndex].subjects[subjectIndex] = { text: "", icon: "", image: "" };
      }
      state.days[dayIndex].subjects[subjectIndex].image = image;
      
      // Auto-salvare
      autoSaveData();
    }

    // Auto-salvare Ã®n timp real (DOAR pentru restaurare, NU pentru template-uri)
    function autoSaveData() {
      try {
        const currentData = {
          school: document.getElementById('school').value,
          year: document.getElementById('year').value,
          grade: document.getElementById('grade').value,
          theme: document.getElementById('theme').value,
          director: document.getElementById('director').value,
          teacher: document.getElementById('teacher').value,
          timeFormat: document.getElementById('timeFormat').value,
          days: state.days,
          timestamp: new Date().toISOString(),
          version: '2.1'
        };
        
        // SalveazÄƒ DOAR pentru restaurare la refresh, NU Ã®n lista de template-uri
        localStorage.setItem('orarCurrentWork', JSON.stringify(currentData));
        localStorage.setItem('orarAutoSave', Date.now().toString());
      } catch (error) {
        console.error('Auto-save error:', error);
      }
    }

    // FormateazÄƒ numele materiei cu majuscule corecte È™i pÄƒstrarea abrevierilor
    function formatSubjectName(text) {
      if (!text) return '';
      const exceptions = ['È™i', 'sau', 'de', 'la', 'Ã®n', 'pe', 'cu', 'din', 'pentru', 'cÄƒtre'];
      const abbreviations = ['LLR', 'TIC', 'IT', 'PE', 'EF']; // Abrevieri care rÄƒmÃ¢n cu majuscule
      
      return text.trim()
        .replace(/\s+/g, ' ')
        .split(' ')
        .map((word, index) => {
          const upper = word.toUpperCase();
          const lower = word.toLowerCase();
          
          // VerificÄƒ dacÄƒ e o abreviere cunoscutÄƒ
          if (abbreviations.includes(upper)) {
            return upper;
          }
          
          // VerificÄƒ dacÄƒ e o excepÈ›ie (cuvÃ¢nt mic)
          if (index > 0 && exceptions.includes(lower)) {
            return lower;
          }
          
          // Formatare normalÄƒ cu prima literÄƒ mare
          return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
        })
        .join(' ');
    }

    // Import din Excel (format tabel)
    function importFromExcel() {
      const excelData = document.getElementById('excel-paste').value.trim();
      if (!excelData) {
        showMessage('âŒ Nu existÄƒ date pentru import din Excel!', 'error');
        return;
      }

      try {
        const lines = excelData.split('\n').map(line => line.trim()).filter(line => line);
        
        // ReseteazÄƒ starea
        state.days.forEach(day => { day.subjects = []; day.count = 0; });

        // Prima linie poate conÈ›ine zilele sau direct materiile
        let startLine = 0;
        const firstLine = lines[0].toLowerCase();
        if (firstLine.includes('luni') || firstLine.includes('marti') || firstLine.includes('miercuri')) {
          startLine = 1; // Sare peste header
        }

        // ProceseazÄƒ fiecare linie ca o orÄƒ
        for (let i = startLine; i < lines.length; i++) {
          const subjects = lines[i].split(/\t|;|,/).map(s => s.trim()).filter(s => s);
          
          subjects.forEach((subject, dayIndex) => {
            if (dayIndex < state.days.length && subject) {
              const icon = getSubjectIcon(subject);
              state.days[dayIndex].subjects.push({
                text: subject,
                icon: icon,
                image: ""
              });
              state.days[dayIndex].count = state.days[dayIndex].subjects.length;
            }
          });
        }

        buildDaysEditor();
        generateSchedule();
        showMessage('ğŸ“Š Date importate cu succes din Excel!', 'success');
        
      } catch (error) {
        showMessage('âŒ Eroare la importul din Excel. VerificÄƒ formatul!', 'error');
        console.error('Excel import error:', error);
      }
    }

    // Import din Word (format text)
    function importFromWord() {
      const wordData = document.getElementById('word-paste').value.trim();
      if (!wordData) {
        showMessage('âŒ Nu existÄƒ date pentru import din Word!', 'error');
        return;
      }

      try {
        const lines = wordData.split('\n').map(line => line.trim()).filter(line => line);
        let currentDayIndex = -1;
        
        // ReseteazÄƒ starea
        state.days.forEach(day => { day.subjects = []; day.count = 0; });

        for (const line of lines) {
          // VerificÄƒ dacÄƒ linia este o zi
          const dayIndex = dayNames.findIndex(day => 
            line.toLowerCase().includes(day.toLowerCase()) || 
            day.toLowerCase().includes(line.toLowerCase().replace(':', ''))
          );
          
          if (dayIndex !== -1) {
            currentDayIndex = dayIndex;
          } else if (currentDayIndex !== -1 && line) {
            // Este o materie
            const icon = getSubjectIcon(line);
            state.days[currentDayIndex].subjects.push({
              text: line,
              icon: icon,
              image: ""
            });
            state.days[currentDayIndex].count = state.days[currentDayIndex].subjects.length;
          }
        }

        buildDaysEditor();
        generateSchedule();
        showMessage('ğŸ“„ Date importate cu succes din Word!', 'success');
        
      } catch (error) {
        showMessage('âŒ Eroare la importul din Word. VerificÄƒ formatul!', 'error');
        console.error('Word import error:', error);
      }
    }

    // ObÈ›ine iconul pentru o materie cu auto-detectare Ã®mbunÄƒtÄƒÈ›itÄƒ
    function getSubjectIcon(subject) {
      const lowerSubject = subject.toLowerCase().trim();
      
      // CautÄƒ Ã®n lista de emoji
      for (const item of subjectEmojiList) {
        for (const keyword of item.keywords) {
          if (lowerSubject.includes(keyword.toLowerCase())) {
            return item.emoji;
          }
        }
      }
      return 'ğŸ“–'; // Icon implicit
    }

    // GenereazÄƒ opÈ›iunile pentru selectorul de emoji
    function getEmojiOptions(selectedEmoji = '') {
      const categories = {};
      
      // GrupeazÄƒ emoji-urile pe categorii
      subjectEmojiList.forEach(item => {
        if (!categories[item.category]) {
          categories[item.category] = [];
        }
        if (!categories[item.category].find(e => e.emoji === item.emoji)) {
          categories[item.category].push(item);
        }
      });

      let options = '';
      Object.keys(categories).forEach(category => {
        options += `<optgroup label="${category}">`;
        categories[category].forEach(item => {
          const selected = item.emoji === selectedEmoji ? 'selected' : '';
          options += `<option value="${item.emoji}" ${selected} title="${item.keywords[0]}">${item.emoji}</option>`;
        });
        options += '</optgroup>';
      });

      return options;
    }

    // Toggle secÈ›iunea de import
    function toggleImportSection() {
      const section = document.getElementById('importSection');
      section.classList.toggle('collapsed');
      
      const toggle = section.querySelector('.import-toggle');
      if (section.classList.contains('collapsed')) {
        toggle.textContent = 'ğŸ”½';
      } else {
        toggle.textContent = 'ğŸ”¼';
      }
    }


    // FuncÈ›ie pentru Ã®ncÄƒrcarea orarului oficial (fÄƒrÄƒ confirmare)
    function loadOfficialSchedule() {
      // ÃncarcÄƒ orarul exact pentru fiecare zi
      state.days.forEach((day, dayIndex) => {
        const dayName = day.name;
        const daySubjects = predefinedSchedule[dayName] || [];
        
        day.subjects = [];
        day.count = daySubjects.length;
        
        daySubjects.forEach(subject => {
          const icon = getSubjectIcon(subject);
          let image = "";
          
          // Adaug imaginile pentru steaguri
          if (subject.includes("Limba È™i literatura romÃ¢nÄƒ") || subject.includes("romÃ¢nÄƒ")) {
            image = "https://upload.wikimedia.org/wikipedia/commons/thumb/7/73/Flag_of_Romania.svg/2560px-Flag_of_Romania.svg.png";
          } else if (subject.includes("Limba englezÄƒ") || subject.includes("englezÄƒ")) {
            image = "https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Flag_of_the_United_Kingdom_%283-5%29.svg/1200px-Flag_of_the_United_Kingdom_%283-5%29.svg.png";
          }
          
          day.subjects.push({
            text: subject,
            icon: icon,
            image: image
          });
        });
      });

      buildDaysEditor();
      generateSchedule();
    }

    // Orele pentru clasele primare (50 min orÄƒ + 10 min pauzÄƒ)
    const timeSlots = [
      '08:00-08:50',
      '09:00-09:50', 
      '10:00-10:50',
      '11:00-11:50',
      '12:00-12:50'
    ];

    // GenereazÄƒ orarul
    function generateSchedule() {
      document.body.classList.add('loading');
      
      setTimeout(() => {
        // ActualizeazÄƒ header-ul conform .docx
        const school = document.getElementById('school').value.trim();
        document.getElementById('outSchool').textContent = school.toUpperCase();
        
        const director = document.getElementById('director').value.trim();
        document.getElementById('outDirector').innerHTML = `Director,<br>${director}`;
        
        const year = document.getElementById('year').value.trim();
        document.getElementById('outYear').textContent = `Anul È™colar ${year}`;
        
        const grade = document.getElementById('grade').value.trim();
        document.getElementById('outTitle').textContent = `ORAR â€“ ${grade.toUpperCase()}`;
        
        const teacher = document.getElementById('teacher').value.trim();
        document.getElementById('outTeacher').textContent = teacher;

        // GenereazÄƒ grid-ul
        const maxRows = Math.max(...state.days.map(d => d.count), 1);
        const grid = document.getElementById('grid');
        grid.innerHTML = '';

        // RÃ¢ndul header
        const headerCells = ['Ora', ...dayNames];
        headerCells.forEach(header => {
          const cell = document.createElement('div');
          cell.className = 'grid-cell header';
          cell.textContent = header;
          grid.appendChild(cell);
        });

        // RÃ¢ndurile cu materii
        for (let row = 0; row < maxRows; row++) {
          // Celula cu ora - verificÄƒ formatul ales
          const periodCell = document.createElement('div');
          periodCell.className = 'grid-cell period';
          const timeFormat = document.getElementById('timeFormat').value;
          
          if (timeFormat === 'hours') {
            periodCell.textContent = timeSlots[row] || `${row + 1}`;
          } else {
            periodCell.textContent = `${row + 1}`;
          }
          grid.appendChild(periodCell);
          
          // Celulele pentru fiecare zi
          state.days.forEach(day => {
            const cell = document.createElement('div');
            cell.className = 'grid-cell';
            
            const subject = day.subjects[row];
            if (subject && subject.text.trim()) {
              const content = document.createElement('div');
              content.className = 'subject-content';
              
              // 1. AdaugÄƒ imaginea deasupra (dacÄƒ existÄƒ) - prioritate faÈ›Äƒ de emoji
              if (subject.image) {
                const img = document.createElement('img');
                img.src = subject.image;
                img.className = 'subject-image';
                img.alt = subject.text;
                content.appendChild(img);
              }
              // 1b. AdaugÄƒ emoji-ul deasupra DOAR dacÄƒ nu existÄƒ imagine
              else if (subject.icon) {
                const icon = document.createElement('div');
                icon.className = 'subject-icon';
                icon.textContent = subject.icon;
                content.appendChild(icon);
              }
              
              // 2. AdaugÄƒ textul sub emoji/imagine
              const text = document.createElement('div');
              text.className = 'subject-text';
              text.textContent = formatSubjectName(subject.text);
              content.appendChild(text);
              
              cell.appendChild(content);
            }
            
            grid.appendChild(cell);
          });
        }

        document.body.classList.remove('loading');
        showMessage('ğŸ¯ Orarul a fost generat cu succes!', 'success');
      }, 300);
    }

    // Export PNG de Ã®naltÄƒ calitate cu gradient È™i texte mari
    async function exportToPNG() {
      showMessage('ğŸ“¸ Generez imaginea de Ã®naltÄƒ calitate...', 'success');
      
      try {
        const sheetElement = document.getElementById('sheet');
        
        // AplicÄƒ stiluri temporare pentru PNG export (texte mari)
        const tempStyle = document.createElement('style');
        tempStyle.id = 'png-export-style';
        tempStyle.textContent = `
          #sheet .main-title { font-size: 34pt !important; }
          #sheet .year-subtitle { font-size: 18pt !important; }
          #sheet .grid-cell { font-size: 18pt !important; min-height: 16mm !important; }
          #sheet .grid-cell.header { font-size: 20pt !important; }
          #sheet .grid-cell.period { font-size: 12pt !important; }
          #sheet .subject-text { font-size: 16pt !important; }
          #sheet .subject-icon { font-size: 32px !important; }
          #sheet .subject-image { width: 44px !important; height: 44px !important; }
          #sheet .sig-name { font-size: 14pt !important; }
          #sheet .sig-role { font-size: 12pt !important; }
        `;
        document.head.appendChild(tempStyle);
        
        // AÈ™teaptÄƒ aplicarea stilurilor
        await new Promise(resolve => setTimeout(resolve, 200));
        
        const canvas = await html2canvas(sheetElement, {
          scale: 3,
          backgroundColor: null,
          useCORS: true,
          allowTaint: true,
          width: sheetElement.offsetWidth,
          height: sheetElement.offsetHeight,
          logging: false,
          removeContainer: false,
          foreignObjectRendering: true,
          imageTimeout: 20000,
          onclone: function(clonedDoc) {
            // AsigurÄƒ-te cÄƒ toate stilurile sunt aplicate Ã®n clonÄƒ
            const clonedStyle = clonedDoc.getElementById('png-export-style');
            if (clonedStyle) {
              clonedStyle.innerHTML = tempStyle.textContent;
            }
          }
        });
        
        // EliminÄƒ stilurile temporare
        document.head.removeChild(tempStyle);
        
        // VerificÄƒ dacÄƒ canvas-ul a fost generat corect
        if (!canvas || canvas.width === 0 || canvas.height === 0) {
          throw new Error('Canvas-ul nu a fost generat corect');
        }
        
        // CreeazÄƒ È™i descarcÄƒ imaginea
        const dataURL = canvas.toDataURL('image/png', 1.0);
        
        if (!dataURL || dataURL === 'data:,') {
          throw new Error('Imaginea nu a fost generatÄƒ corect');
        }
        
        const link = document.createElement('a');
        const grade = document.getElementById('grade').value.trim().replace(/\s+/g, '_');
        const theme = document.getElementById('theme').options[document.getElementById('theme').selectedIndex].text.replace(/[ğŸ¨ğŸŒˆğŸ¦‹ğŸŒ¿ğŸŒŠğŸš€ğŸ­ğŸ»ğŸ“šğŸ‘¸ğŸ¤–âœ¨]/g, '').trim();
        link.download = `Orar_${grade}_${theme}_${new Date().getTime()}.png`;
        link.href = dataURL;
        
        // ForÈ›eazÄƒ descÄƒrcarea
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showMessage('ğŸ“¸ Imaginea PNG a fost descÄƒrcatÄƒ cu gradient È™i texte mari!', 'success');
      } catch (error) {
        showMessage('âŒ Eroare la generarea PNG: ' + error.message, 'error');
        console.error('PNG export error:', error);
        
        // Fallback - Ã®ncearcÄƒ cu setÄƒri mai simple
        try {
          showMessage('ğŸ”„ Ãncerc cu setÄƒri alternative...', 'success');
          const canvas = await html2canvas(document.getElementById('sheet'), {
            scale: 1,
            backgroundColor: 'white'
          });
          
          const link = document.createElement('a');
          link.download = `Orar_Fallback_${new Date().getTime()}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
          
          showMessage('ğŸ“¸ Imaginea PNG alternativÄƒ a fost descÄƒrcatÄƒ!', 'success');
        } catch (fallbackError) {
          showMessage('âŒ Nu s-a putut genera imaginea PNG. ÃncearcÄƒ sÄƒ refreshezi pagina.', 'error');
        }
      }
    }

    // Sistem de management template-uri
    function getSavedTemplates() {
      try {
        const saved = localStorage.getItem('orarTemplates');
        return saved ? JSON.parse(saved) : [];
      } catch (error) {
        console.error('Error loading templates:', error);
        return [];
      }
    }

    function generateTemplateName(teacherName) {
      const templates = getSavedTemplates();
      const baseTeacher = teacherName.trim();
      
      if (!baseTeacher) {
        return `Template ${templates.length + 1}`;
      }
      
      // NumÄƒrÄƒ template-urile existente pentru acelaÈ™i profesor
      const sameTeacherCount = templates.filter(t => 
        t.teacher.toLowerCase().includes(baseTeacher.toLowerCase()) ||
        baseTeacher.toLowerCase().includes(t.teacher.toLowerCase())
      ).length;
      
      if (sameTeacherCount === 0) {
        return baseTeacher;
      } else {
        return `${baseTeacher} ${sameTeacherCount + 1}`;
      }
    }

    // SalveazÄƒ template-ul cu sistem de management
    function saveTemplate() {
      try {
        // ColecteazÄƒ toate datele din inputuri
        const currentState = {
          days: state.days.map(day => ({
            name: day.name,
            count: day.count,
            subjects: day.subjects.map(subject => ({
              text: subject.text || '',
              icon: subject.icon || '',
              image: subject.image || ''
            }))
          }))
        };

        const teacherName = document.getElementById('teacher').value.trim();
        const templateName = generateTemplateName(teacherName);
        
        const templateData = {
          id: Date.now().toString(),
          name: templateName,
          school: document.getElementById('school').value,
          year: document.getElementById('year').value,
          grade: document.getElementById('grade').value,
          theme: document.getElementById('theme').value,
          director: document.getElementById('director').value,
          teacher: teacherName,
          days: currentState.days,
          timestamp: new Date().toISOString(),
          version: '2.1'
        };
        
        // ÃncarcÄƒ template-urile existente È™i adaugÄƒ noul
        const templates = getSavedTemplates();
        templates.push(templateData);
        
        // PÄƒstreazÄƒ doar ultimele 10 template-uri
        if (templates.length > 10) {
          templates.splice(0, templates.length - 10);
        }
        
        localStorage.setItem('orarTemplates', JSON.stringify(templates));
        localStorage.setItem('orarCurrentTemplate', JSON.stringify(templateData));
        
        showMessage(`ğŸ’¾ Template "${templateName}" salvat cu succes! Total: ${templates.length} template-uri.`, 'success');
        
        // ActualizeazÄƒ lista de template-uri
        updateTemplatesList();
        
      } catch (error) {
        showMessage('âŒ Eroare la salvarea template-ului: ' + error.message, 'error');
        console.error('Save error:', error);
      }
    }

    // ActualizeazÄƒ lista de template-uri Ã®n interfaÈ›Äƒ
    function updateTemplatesList() {
      const templates = getSavedTemplates();
      const listContainer = document.getElementById('templatesList');
      
      if (templates.length === 0) {
        listContainer.innerHTML = '<p style="font-size: 12px; color: var(--muted); text-align: center; padding: 10px;">Nu existÄƒ template-uri salvate Ã®ncÄƒ.</p>';
        return;
      }
      
      listContainer.innerHTML = '';
      
      templates.forEach((template, index) => {
        const templateItem = document.createElement('div');
        templateItem.className = 'template-item';
        templateItem.innerHTML = `
          <div class="template-info">
            <div class="template-name">${template.name}</div>
            <div class="template-details">${template.grade} â€¢ ${template.school}</div>
            <div class="template-date">${new Date(template.timestamp).toLocaleDateString('ro-RO')}</div>
          </div>
          <div class="template-actions">
            <button class="btn-mini" onclick="loadTemplateById('${template.id}')" title="ÃncarcÄƒ template">ğŸ“‚</button>
            <button class="btn-mini danger" onclick="deleteTemplate('${template.id}')" title="È˜terge template">ğŸ—‘ï¸</button>
          </div>
        `;
        listContainer.appendChild(templateItem);
      });
    }

    // ÃncarcÄƒ un template specific dupÄƒ ID
    function loadTemplateById(templateId) {
      try {
        const templates = getSavedTemplates();
        const template = templates.find(t => t.id === templateId);
        
        if (!template) {
          showMessage('âŒ Template-ul nu a fost gÄƒsit!', 'error');
          return;
        }
        
        // ÃncarcÄƒ toate datele
        document.getElementById('school').value = template.school || '';
        document.getElementById('year').value = template.year || '2025â€“2026';
        document.getElementById('grade').value = template.grade || 'Clasa a III-a';
        document.getElementById('theme').value = template.theme || 'playful';
        document.getElementById('director').value = template.director || '';
        document.getElementById('teacher').value = template.teacher || '';
        
        // RestaureazÄƒ zilele cu toate datele
        if (template.days && Array.isArray(template.days)) {
          state.days = template.days.map(day => ({
            name: day.name,
            count: day.count || 0,
            subjects: (day.subjects || []).map(subject => ({
              text: subject.text || '',
              icon: subject.icon || '',
              image: subject.image || ''
            }))
          }));
        }
        
        document.body.setAttribute('data-theme', template.theme || 'playful');
        
        buildDaysEditor();
        generateSchedule();
        
        showMessage(`ğŸ“‚ Template "${template.name}" Ã®ncÄƒrcat cu succes!`, 'success');
        
      } catch (error) {
        showMessage('âŒ Eroare la Ã®ncÄƒrcarea template-ului: ' + error.message, 'error');
        console.error('Load template error:', error);
      }
    }

    // Variabile pentru popup-ul custom
    let confirmCallback = null;

    // AfiÈ™eazÄƒ popup-ul custom de confirmare
    function showConfirmModal(title, message, callback) {
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalMessage').textContent = message;
      document.getElementById('confirmModal').style.display = 'flex';
      confirmCallback = callback;
    }

    // Ãnchide popup-ul custom
    function closeConfirmModal() {
      document.getElementById('confirmModal').style.display = 'none';
      confirmCallback = null;
    }

    // ExecutÄƒ acÈ›iunea confirmatÄƒ
    function confirmAction() {
      if (confirmCallback) {
        confirmCallback();
      }
      closeConfirmModal();
    }

    // È˜terge un template cu popup custom
    function deleteTemplate(templateId) {
      const templates = getSavedTemplates();
      const template = templates.find(t => t.id === templateId);
      
      if (!template) {
        showMessage('âŒ Template-ul nu a fost gÄƒsit!', 'error');
        return;
      }
      
      showConfirmModal(
        'ğŸ—‘ï¸ È˜terge Template',
        `Sigur vrei sÄƒ È™tergi template-ul "${template.name}"? AceastÄƒ acÈ›iune nu poate fi anulatÄƒ.`,
        () => {
          try {
            const filteredTemplates = templates.filter(t => t.id !== templateId);
            localStorage.setItem('orarTemplates', JSON.stringify(filteredTemplates));
            updateTemplatesList();
            showMessage('ğŸ—‘ï¸ Template È™ters cu succes!', 'success');
          } catch (error) {
            showMessage('âŒ Eroare la È™tergerea template-ului!', 'error');
            console.error('Delete template error:', error);
          }
        }
      );
    }

    // ÃncarcÄƒ datele de lucru curente (auto-salvate)
    function loadCurrentWork() {
      try {
        const saved = localStorage.getItem('orarCurrentWork');
        if (saved) {
          const data = JSON.parse(saved);
          
          document.getElementById('school').value = data.school || '';
          document.getElementById('year').value = data.year || '2025â€“2026';
          document.getElementById('grade').value = data.grade || 'Clasa a III-a';
          document.getElementById('theme').value = data.theme || 'playful';
          document.getElementById('director').value = data.director || '';
          document.getElementById('teacher').value = data.teacher || '';
          document.getElementById('timeFormat').value = data.timeFormat || 'hours';
          
          // RestaureazÄƒ zilele cu toate datele (text, emoji, imagini)
          if (data.days && Array.isArray(data.days)) {
            state.days = data.days.map(day => ({
              name: day.name,
              count: day.count || 0,
              subjects: (day.subjects || []).map(subject => ({
                text: subject.text || '',
                icon: subject.icon || '',
                image: subject.image || ''
              }))
            }));
            
            console.log('Lucrul curent restaurat din auto-save');
          }
          
          document.body.setAttribute('data-theme', data.theme || 'playful');
          return true; // A gÄƒsit date salvate
        }
        return false; // Nu a gÄƒsit date salvate
      } catch (e) {
        console.log('No current work found:', e);
        return false;
      }
    }

    // GoleÈ™te toate datele
    function clearAll() {
      if (confirm('Sigur vrei sÄƒ È™tergi toate datele? AceastÄƒ acÈ›iune nu poate fi anulatÄƒ.')) {
        state.days.forEach(d => { d.count = 0; d.subjects = []; });
        buildDaysEditor();
        document.getElementById('grid').innerHTML = '';
        document.getElementById('excel-paste').value = '';
        document.getElementById('word-paste').value = '';
        showMessage('ğŸ§¹ Toate datele au fost È™terse!', 'success');
      }
    }

    // AfiÈ™eazÄƒ mesaj
    function showMessage(text, type = 'success') {
      const container = document.getElementById('successMessage');
      container.innerHTML = `<div class="success-message show">${text}</div>`;
      setTimeout(() => { container.innerHTML = ''; }, 4000);
    }

    // SchimbÄƒ tema
    document.getElementById('theme').addEventListener('change', function() {
      document.body.style.opacity = '0.8';
      setTimeout(() => {
        document.body.setAttribute('data-theme', this.value);
        document.body.style.opacity = '1';
        const themeName = this.options[this.selectedIndex].text;
        showMessage(`ğŸ¨ Tema schimbatÄƒ la: ${themeName}`, 'success');
      }, 150);
    });


    // ScurtÄƒturi tastaturÄƒ
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'Enter':
            e.preventDefault();
            generateSchedule();
            break;
          case 'p':
            e.preventDefault();
            window.print();
            break;
          case 's':
            e.preventDefault();
            if (e.shiftKey) {
              saveTemplate();
            } else {
              exportToPNG();
            }
            break;
        }
      }
    });

    // Cache busting pentru CSS
    function checkVersion() {
      const currentVersion = '2.3';
      const savedVersion = localStorage.getItem('orarVersion');
      
      if (savedVersion !== currentVersion) {
        // Versiune nouÄƒ - doar refresh CSS, pÄƒstreazÄƒ template-urile
        localStorage.setItem('orarVersion', currentVersion);
        
        // ForÈ›eazÄƒ refresh pentru CSS
        const links = document.querySelectorAll('link[rel="stylesheet"]');
        links.forEach(link => {
          const href = link.href.split('?')[0];
          link.href = href + '?v=' + currentVersion + '&t=' + Date.now();
        });
        
        showMessage('ğŸ”„ AplicaÈ›ia a fost actualizatÄƒ la versiunea ' + currentVersion + '!', 'success');
      }
    }

    // Auto-salvare pentru input-uri (fÄƒrÄƒ template-uri)
    function setupAutoSave() {
      const inputs = ['school', 'year', 'grade', 'director', 'teacher'];
      inputs.forEach(id => {
        document.getElementById(id).addEventListener('input', autoSaveData);
      });
      document.getElementById('theme').addEventListener('change', autoSaveData);
      document.getElementById('timeFormat').addEventListener('change', () => {
        autoSaveData();
        generateSchedule(); // RegenereazÄƒ orarul cÃ¢nd se schimbÄƒ formatul
      });
    }

    // IniÈ›ializare
    document.addEventListener('DOMContentLoaded', () => {
      checkVersion();
      
      // ÃncearcÄƒ sÄƒ restaureze lucrul curent sau Ã®ncarcÄƒ orarul oficial
      const hasCurrentWork = loadCurrentWork();
      if (!hasCurrentWork) {
        // Doar dacÄƒ nu existÄƒ lucru salvat, Ã®ncarcÄƒ orarul oficial
        loadOfficialSchedule();
      }
      
      // ConstruieÈ™te editorul de zile
      buildDaysEditor();
      
      // GenereazÄƒ orarul pentru previzualizare
      generateSchedule();
      
      // IniÈ›ializeazÄƒ lista de template-uri
      updateTemplatesList();
      
      // ActiveazÄƒ auto-salvarea pentru input-uri
      setupAutoSave();
      
      // Mesaj de bun venit
      setTimeout(() => {
        showMessage('ğŸ‰ Generator de orar avansat Ã®ncÄƒrcat! 16 designuri disponibile È™i sistem de template-uri avansat.', 'success');
      }, 1000);
    });
  </script>
</body>
</html>